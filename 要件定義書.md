# シフト管理Webアプリ 要件定義書

## 🎯 アプリの目的

- 宴会・婚礼等のイベントに対して、スタッフの出勤可能時間やスキル情報を元に最適なシフトを作成する。
- スタッフの出勤可能時間は手入力される。
- 自動割当の条件に基づいて、シフトを公平かつ効率的に構成する。

---

## 🗂️ テーブル構成

### `users`（ユーザー）

| カラム名         | 型      | 説明                         |
|------------------|---------|------------------------------|
| id               | INT     | 主キー                       |
| name             | TEXT    | ユーザー名                   |
| gender           | TEXT    | 性別（M/F）                  |
| is_highschool    | BOOLEAN | 高校生かどうか               |
| max_workdays     | INT     | 出勤上限（参考情報）         |
| is_rank          | TEXT    | 'ランナー' または 'ランナー以外' |

---

### `skills`（スキル）

| カラム名     | 型   | 説明                              |
|--------------|------|-----------------------------------|
| id           | INT  | 主キー                            |
| user_id      | INT  | ユーザーID（外部キー）           |
| task_type_id | INT  | タスク種別ID（外部キー）         |
| skill_level  | TEXT | 'できる' / 'まあまあできる' / 'できない' |

---

### `task_types`（タスクの種類）

| カラム名 | 型   | 説明                       |
|----------|------|----------------------------|
| id       | INT  | 主キー                     |
| name     | TEXT | 両親、ライト |

---

### `events`（イベント）

| カラム名   | 型     | 説明                           |
|------------|--------|--------------------------------|
| id         | INT    | 主キー                         |
| event_date | DATE   | 開催日                         |
| start_time | TIME   | 開始時間                       |
| end_time   | TIME   | 終了時間                       |
| event_type | TEXT   | ビュッフェ / コース / 会議 / 婚礼など |
| needs      | JSON   | 必要な役割数の例：{"両親": "1-2", "ライト": 1} |

**JSONフォーマット仕様：**
- 固定数: 数値で指定（例：1, 2, 3）
- 範囲指定: 文字列で指定（例："1-2", "2-3"）
- 範囲指定の扱い: 最小値を優先（"1-2"の場合、最低1人を選出）

---

### `availability`（出勤可能情報）

| カラム名             | 型      | 説明                            |
|----------------------|---------|---------------------------------|
| id                   | INT     | 主キー                          |
| user_id              | INT     | ユーザーID（外部キー）         |
| event_id             | INT     | イベントID（外部キー）         |
| available            | BOOLEAN | 出勤可能かどうか               |
| available_start_time | TIME    | 出勤可能な開始時間             |
| available_end_time   | TIME    | 出勤可能な終了時間             |

---

### `assignments`（割当結果：将来的に使用）

| カラム名       | 型   | 説明                             |
|----------------|------|----------------------------------|
| id             | INT  | 主キー                           |
| user_id        | INT  | ユーザーID（外部キー）          |
| event_id       | INT  | イベントID（外部キー）          |
| assigned_role  | TEXT | 担当内容（例：ランナー、両親など） |
| note           | TEXT | 備考                             |

---

## 🧠 自動割当時の条件分（使用する）

1. **出勤可能時間がイベントと一致していること**
2. **ランナー可否（is_rank = 'ランナー'）とランナー種別対応（A / D / 両方）**
3. **経験バランス（能力×階級）**
   - 例：熟練1名 + 新人2名のように構成

---

## 🚫 条件文に含めないが表示で対応するもの

- **出勤日数の上限**：出勤件数と max_workdays を比較し、警告として表示
- **男女比の調整**：UIにて表示（棒グラフ・比率など）

---

## 🛠️ 現在の実装対象

### **1. 管理者による出勤時間入力機能**
- **出勤可能時間の入力（手入力）**
  - availability テーブルに保存
  - 管理者が各スタッフの出勤可能時間を代理入力
  
### **2. 宴会条件入力画面**
- **入力項目：**
  - 宴会形態（ビュッフェ / コース / 会議 / 婚礼など）
  - 宴会規模（必要人数の詳細）
  - 日付・時間
  - 必要な役割と人数
  
### **3. 自動選出・出力画面**
- **出力形式：**
  - ランナー優先でリスト表示
  - ランナー以外を続けて表示
  - 各人の出勤可能時間も併記

---

## 🔮 今後のステップ

### フェーズ1：シフト自動割当（小規模から開始）
- 指定イベントに対して、条件を満たすユーザーを自動選出
- ランナー → 婚礼（両親/ライト） → その他で割当

### フェーズ2：UIサポート機能
- 出勤回数警告、男女比表示、手動割当補助など

### フェーズ3：本格的な自動化と最適化
- 複数イベント同時割当、最適人員配分、調整機能など

---

